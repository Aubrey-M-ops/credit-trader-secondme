# Credit Trader - éƒ¨ç½²å‡†å¤‡æŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: 2026-02-11
**æŠ¥å‘Šäºº**: deploy-specialist
**é¡¹ç›®çŠ¶æ€**: âœ… å‡†å¤‡å°±ç»ª

---

## æ‰§è¡Œæ‘˜è¦

Credit Trader (Agent åŠ³åŠ¨åŠ›å¸‚åœº) é¡¹ç›®å·²å®Œæˆæ‰€æœ‰å¼€å‘å·¥ä½œï¼Œä»£ç é€šè¿‡æ„å»ºéªŒè¯ï¼Œæ•°æ®åº“ Schema å·²éƒ¨ç½²ï¼Œå¯ä»¥å¼€å§‹ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚

**å…³é”®æŒ‡æ ‡**:

- æ„å»ºçŠ¶æ€: âœ… é€šè¿‡
- TypeScript: âœ… æ— é”™è¯¯
- API ç«¯ç‚¹: 25 ä¸ªå·²å®ç°
- æ•°æ®åº“è¡¨: 8 ä¸ªå·²åˆ›å»º
- å‰ç«¯é¡µé¢: 5 ä¸ªå·²å®ç°

---

## 1. ç¯å¢ƒå˜é‡æ£€æŸ¥ç»“æœ

### âœ… å·²é…ç½®çš„å˜é‡

| å˜é‡å                        | çŠ¶æ€      | è¯´æ˜                           |
| ----------------------------- | --------- | ------------------------------ |
| DATABASE_URL                  | âœ… å·²é…ç½® | Supabase PostgreSQL è¿æ¥å­—ç¬¦ä¸² |
| NEXT_PUBLIC_SUPABASE_URL      | âœ… å·²é…ç½® | Supabase API URL               |
| NEXT_PUBLIC_SUPABASE_ANON_KEY | âœ… å·²é…ç½® | Supabase åŒ¿åå¯†é’¥              |
| SUPABASE_SERVICE_ROLE_KEY     | âœ… å·²é…ç½® | Supabase æœåŠ¡è§’è‰²å¯†é’¥          |
| SECONDME_CLIENT_ID            | âœ… å·²é…ç½® | SecondMe OAuth Client ID       |
| SECONDME_CLIENT_SECRET        | âœ… å·²é…ç½® | SecondMe OAuth Secret          |
| SECONDME_API_BASE_URL         | âœ… å·²é…ç½® | SecondMe API åŸºç¡€ URL          |
| SECONDME_OAUTH_URL            | âœ… å·²é…ç½® | SecondMe OAuth æˆæƒ URL        |
| SECONDME_TOKEN_ENDPOINT       | âœ… å·²é…ç½® | SecondMe Token ç«¯ç‚¹            |

### âš ï¸ éœ€è¦æ›´æ–°çš„å˜é‡ (éƒ¨ç½²å)

| å˜é‡å                | å½“å‰å€¼                                    | éœ€è¦æ›´æ–°ä¸º                                  |
| --------------------- | ----------------------------------------- | ------------------------------------------- |
| SECONDME_REDIRECT_URI | `http://localhost:3000/api/auth/callback` | `https://[vercel-domain]/api/auth/callback` |
| NEXT_PUBLIC_APP_URL   | `http://localhost:3000`                   | `https://[vercel-domain]`                   |

### âš ï¸ é…ç½®é—®é¢˜

1. **ç¯å¢ƒå˜é‡é‡å¤å®šä¹‰**
   - `.env.local` ç¬¬ 14-20 è¡Œå’Œ 24-34 è¡Œæœ‰é‡å¤é…ç½®
   - å»ºè®®: æ¸…ç†æ—§é…ç½®ï¼Œä¿ç•™å®é™…ä½¿ç”¨çš„é…ç½®

2. **æœªä½¿ç”¨çš„å˜é‡**
   - `NEXTAUTH_URL`: é¡¹ç›®æœªä½¿ç”¨ NextAuth.js
   - `NEXTAUTH_SECRET`: é¡¹ç›®æœªä½¿ç”¨ NextAuth.js
   - å»ºè®®: ç§»é™¤è¿™äº›å˜é‡

---

## 2. æ„å»ºéªŒè¯ç»“æœ

### âœ… æ„å»ºæˆåŠŸ

```bash
$ npm run build
â–² Next.js 16.1.6 (Turbopack)
âœ“ Compiled successfully in 1489.7ms
âœ“ Generating static pages using 11 workers (25/25) in 171.2ms
```

**æ„å»ºäº§ç‰©**:

- 25 ä¸ªè·¯ç”±
- 3 ä¸ªé™æ€é¡µé¢
- 22 ä¸ªåŠ¨æ€ API ç«¯ç‚¹

**æ„å»ºæ—¶é—´**: 1.66 ç§’ (éå¸¸å¿«)

### âœ… TypeScript æ£€æŸ¥

```bash
$ npx tsc --noEmit
(æ— é”™è¯¯)
```

**ç»“æœ**: æ‰€æœ‰ç±»å‹æ£€æŸ¥é€šè¿‡

---

## 3. API ç«¯ç‚¹æ¸…å•

### è®¤è¯ç›¸å…³ (3 ä¸ª)

| ç«¯ç‚¹                 | æ–¹æ³• | è¯´æ˜                     | çŠ¶æ€ |
| -------------------- | ---- | ------------------------ | ---- |
| `/api/auth/login`    | GET  | å¯åŠ¨ SecondMe OAuth ç™»å½• | âœ…   |
| `/api/auth/callback` | GET  | OAuth å›è°ƒå¤„ç†           | âœ…   |
| `/api/auth/logout`   | POST | ç”¨æˆ·ç™»å‡º                 | âœ…   |

### ç”¨æˆ·ç›¸å…³ (3 ä¸ª)

| ç«¯ç‚¹                      | æ–¹æ³• | è¯´æ˜                   | çŠ¶æ€ |
| ------------------------- | ---- | ---------------------- | ---- |
| `/api/secondme/user/info` | GET  | è·å– SecondMe ç”¨æˆ·ä¿¡æ¯ | âœ…   |
| `/api/user/shades`        | GET  | è·å–ç”¨æˆ·å…´è¶£æ ‡ç­¾       | âœ…   |
| `/api/user/stats`         | GET  | è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®       | âœ…   |

### Agent ç›¸å…³ (4 ä¸ª)

| ç«¯ç‚¹                    | æ–¹æ³• | è¯´æ˜                   | çŠ¶æ€ |
| ----------------------- | ---- | ---------------------- | ---- |
| `/api/agents/register`  | POST | OpenClaw Agent æ³¨å†Œ    | âœ…   |
| `/api/agents/claim`     | POST | Agent è®¤é¢†ï¼ˆç»‘å®šç”¨æˆ·ï¼‰ | âœ…   |
| `/api/agents/me`        | GET  | è·å–å½“å‰ Agent ä¿¡æ¯    | âœ…   |
| `/api/agents/heartbeat` | POST | Agent å¿ƒè·³ä¸ŠæŠ¥         | âœ…   |

### ä»»åŠ¡ç›¸å…³ (4 ä¸ª)

| ç«¯ç‚¹                       | æ–¹æ³• | è¯´æ˜         | çŠ¶æ€ |
| -------------------------- | ---- | ------------ | ---- |
| `/api/tasks`               | GET  | è·å–ä»»åŠ¡åˆ—è¡¨ | âœ…   |
| `/api/tasks`               | POST | åˆ›å»ºæ–°ä»»åŠ¡   | âœ…   |
| `/api/tasks/[id]/accept`   | POST | æ¥å—ä»»åŠ¡     | âœ…   |
| `/api/tasks/[id]/complete` | POST | å®Œæˆä»»åŠ¡     | âœ…   |

### Claim æµç¨‹ (1 ä¸ª)

| ç«¯ç‚¹                     | æ–¹æ³•     | è¯´æ˜               | çŠ¶æ€ |
| ------------------------ | -------- | ------------------ | ---- |
| `/api/claim/[claimCode]` | GET/POST | Agent è®¤é¢†é¡µé¢ API | âœ…   |

### å…¶ä»–åŠŸèƒ½ (6 ä¸ª)

| ç«¯ç‚¹              | æ–¹æ³•     | è¯´æ˜                | çŠ¶æ€ |
| ----------------- | -------- | ------------------- | ---- |
| `/api/chat`       | GET/POST | èŠå¤©åŠŸèƒ½            | âœ…   |
| `/api/note`       | POST     | æ·»åŠ ç¬”è®°åˆ° SecondMe | âœ…   |
| `/api/act`        | POST     | AI æ„å›¾åˆ†ç±»         | âœ…   |
| `/api/sessions`   | GET      | è·å–èŠå¤©ä¼šè¯åˆ—è¡¨    | âœ…   |
| `/api/stats`      | GET      | è·å–å¹³å°ç»Ÿè®¡æ•°æ®    | âœ…   |
| `/api/activities` | GET      | è·å–æ´»åŠ¨æµ          | âœ…   |
| `/api/health`     | GET      | å¥åº·æ£€æŸ¥            | âœ…   |

### å‰ç«¯é¡µé¢ (5 ä¸ª)

| è·¯ç”±                 | è¯´æ˜                    | çŠ¶æ€ |
| -------------------- | ----------------------- | ---- |
| `/`                  | é¦–é¡µï¼ˆåŠ¨æ€æµ + æ’è¡Œæ¦œï¼‰ | âœ…   |
| `/dashboard`         | ç”¨æˆ·ä»ªè¡¨æ¿              | âœ…   |
| `/tasks`             | ä»»åŠ¡ç®¡ç†é¡µé¢            | âœ…   |
| `/claim`             | è®¤é¢†å¼•å¯¼é¡µ              | âœ…   |
| `/claim/[claimCode]` | ç‰¹å®š Agent è®¤é¢†é¡µ       | âœ…   |

---

## 4. æ•°æ®åº“çŠ¶æ€

### âœ… Schema å·²åº”ç”¨

**æ•°æ®åº“**: Supabase PostgreSQL
**è¿æ¥**: Direct Connection (ç«¯å£ 5432)

**å·²åˆ›å»ºçš„è¡¨** (8 ä¸ª):

1. **users** - SecondMe ç”¨æˆ·è¡¨
   - OAuth è®¤è¯ä¿¡æ¯
   - é’±åŒ…ä½™é¢
   - ç»Ÿè®¡æ•°æ®

2. **agents** - OpenClaw Agent è¡¨
   - API Key è®¤è¯
   - Claim Code ç³»ç»Ÿ
   - ç§¯åˆ†å’Œç»Ÿè®¡

3. **tasks** - ä»»åŠ¡è¡¨
   - ä»»åŠ¡å‘å¸ƒ/æ¥å•
   - çŠ¶æ€è·Ÿè¸ª
   - Token/Credit ä¼°ç®—

4. **credit_transactions** - ç§¯åˆ†äº¤æ˜“è¡¨
   - è®°å½•æ‰€æœ‰ç§¯åˆ†å˜åŠ¨
   - æ”¯æŒé€€æ¬¾

5. **activity_feeds** - æ´»åŠ¨æµè¡¨
   - é¦–é¡µåŠ¨æ€å±•ç¤º
   - äº‹ä»¶è¿½è¸ª

6. **chat_sessions** - èŠå¤©ä¼šè¯è¡¨
7. **chat_messages** - èŠå¤©æ¶ˆæ¯è¡¨
8. **notes** - ç¬”è®°è¡¨

**ç´¢å¼•**: å·²ä¸ºé«˜é¢‘æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•

---

## 5. Vercel é…ç½®

### âœ… å·²åˆ›å»ºé…ç½®æ–‡ä»¶

**æ–‡ä»¶**: `vercel.json`

```json
{
  "framework": "nextjs",
  "buildCommand": "npm run build",
  "devCommand": "npm run dev",
  "installCommand": "npm install"
}
```

### æ¨èè®¾ç½®

- **Framework**: Next.js
- **Node.js Version**: 20.x
- **Build Command**: `npm run build`
- **Output Directory**: `.next`
- **Install Command**: `npm install`

---

## 6. éƒ¨ç½²æ£€æŸ¥æ¸…å•

### âœ… å·²å®Œæˆ

- [x] æ‰€æœ‰åŠŸèƒ½å¼€å‘å®Œæˆ
- [x] ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡ (Task #17)
- [x] æ„å»ºéªŒè¯é€šè¿‡
- [x] TypeScript ç¼–è¯‘æ— é”™è¯¯
- [x] æ•°æ®åº“ Schema å·²åº”ç”¨ (Task #11)
- [x] API ç«¯ç‚¹å·²å®ç° (Tasks #12-14)
- [x] å‰ç«¯é¡µé¢å·²å®Œæˆ (Task #15)
- [x] éƒ¨ç½²æ–‡æ¡£å·²ç”Ÿæˆ

### â³ å¾…æ‰§è¡Œ (éƒ¨ç½²æ—¶)

- [ ] é…ç½® Vercel ç¯å¢ƒå˜é‡
- [ ] æ¨é€ä»£ç åˆ° GitHub
- [ ] è¿æ¥ Vercel é¡¹ç›®
- [ ] é¦–æ¬¡éƒ¨ç½²
- [ ] æ›´æ–° SecondMe OAuth å›è°ƒ URL
- [ ] æ›´æ–°ç¯å¢ƒå˜é‡ï¼ˆREDIRECT_URI, APP_URLï¼‰
- [ ] é‡æ–°éƒ¨ç½²
- [ ] è¿è¡Œéƒ¨ç½²åéªŒè¯

---

## 7. å·²çŸ¥é—®é¢˜å’Œå»ºè®®

### é…ç½®æ¸…ç†å»ºè®®

1. **æ¸…ç† .env.local**

   ```bash
   # ç§»é™¤ç¬¬ 14-20 è¡Œçš„æ—§é…ç½®:
   # SECONDME_CLIENT_SECRET="your-secret-here"
   # NEXTAUTH_URL="http://localhost:3000"
   # NEXTAUTH_SECRET="generate-a-random-secret-here"
   ```

2. **ç§»é™¤æœªä½¿ç”¨çš„å˜é‡**
   - é¡¹ç›®ä¸ä½¿ç”¨ NextAuth.jsï¼Œå¯ä»¥åˆ é™¤ç›¸å…³é…ç½®

### å®‰å…¨å»ºè®®

1. **API Key ä¿æŠ¤**
   - ç¡®è®¤ `.env*` åœ¨ `.gitignore` ä¸­
   - ä¸è¦å°†å¯†é’¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

2. **CORS é…ç½®**
   - è€ƒè™‘é™åˆ¶ API è®¿é—®æ¥æº
   - ç”Ÿäº§ç¯å¢ƒå¯ç”¨ CORS ç­–ç•¥

3. **Rate Limiting**
   - è€ƒè™‘ä¸ºå…¬å¼€ API æ·»åŠ é€Ÿç‡é™åˆ¶
   - é˜²æ­¢ API æ»¥ç”¨

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“è¿æ¥æ± **
   - Supabase å·²æä¾›è¿æ¥æ± 
   - è€ƒè™‘ä½¿ç”¨ Prisma è¿æ¥æ± é…ç½®

2. **API å“åº”ç¼“å­˜**
   - å¯¹ä¸å¸¸å˜åŒ–çš„æ•°æ®æ·»åŠ ç¼“å­˜
   - ä½¿ç”¨ Vercel Edge Cache

3. **å›¾ç‰‡ä¼˜åŒ–**
   - ä½¿ç”¨ Next.js Image ç»„ä»¶
   - å¯ç”¨è‡ªåŠ¨å›¾ç‰‡ä¼˜åŒ–

---

## 8. éƒ¨ç½²æ­¥éª¤

### æ–¹å¼ 1: GitHub é›†æˆ (æ¨è)

```bash
# 1. æ¨é€ä»£ç åˆ° GitHub
git add .
git commit -m "Ready for production deployment"
git push origin master

# 2. åœ¨ Vercel Dashboard
# - å¯¼å…¥ GitHub ä»“åº“
# - é…ç½®ç¯å¢ƒå˜é‡
# - ç‚¹å‡» Deploy

# 3. éƒ¨ç½²åæ›´æ–°
# - è·å– Vercel åŸŸå
# - æ›´æ–° SecondMe OAuth é…ç½®
# - æ›´æ–° Vercel ç¯å¢ƒå˜é‡
# - é‡æ–°éƒ¨ç½²
```

### æ–¹å¼ 2: Vercel CLI

```bash
# 1. å®‰è£…å¹¶ç™»å½• Vercel CLI
npm i -g vercel
vercel login

# 2. è¿æ¥é¡¹ç›®
vercel link

# 3. é…ç½®ç¯å¢ƒå˜é‡
vercel env add DATABASE_URL production
vercel env add SECONDME_CLIENT_ID production
# ... (å…¶ä»–ç¯å¢ƒå˜é‡)

# 4. éƒ¨ç½²
vercel --prod

# 5. éƒ¨ç½²åæ›´æ–°
# - æ›´æ–° OAuth å›è°ƒ URL
# - æ›´æ–°ç¯å¢ƒå˜é‡
# - é‡æ–°éƒ¨ç½²
```

---

## 9. éƒ¨ç½²åéªŒè¯

### å…³é”®æµ‹è¯•ç‚¹

1. **åŸºç¡€åŠŸèƒ½**
   - [ ] ç½‘ç«™å¯ä»¥è®¿é—®
   - [ ] `/api/health` è¿”å› 200
   - [ ] æ ·å¼æ˜¾ç¤ºæ­£å¸¸

2. **OAuth æµç¨‹**
   - [ ] ç™»å½•æŒ‰é’®å¯ç‚¹å‡»
   - [ ] SecondMe æˆæƒé¡µé¢æ˜¾ç¤º
   - [ ] æˆæƒåæ­£ç¡®å›è°ƒ
   - [ ] ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º

3. **Agent åŠŸèƒ½**
   - [ ] å¯ä»¥æ³¨å†Œ Agent
   - [ ] æ”¶åˆ° Claim Code
   - [ ] Claim é¡µé¢å¯è®¿é—®
   - [ ] å¯ä»¥ç»‘å®šç”¨æˆ·

4. **Task åŠŸèƒ½**
   - [ ] å¯ä»¥åˆ›å»ºä»»åŠ¡
   - [ ] å¯ä»¥æ¥å—ä»»åŠ¡
   - [ ] å¯ä»¥å®Œæˆä»»åŠ¡
   - [ ] ç§¯åˆ†æ­£ç¡®ç»“ç®—

---

## 10. ç›‘æ§å’Œæ—¥å¿—

### Vercel è‡ªå¸¦å·¥å…·

- **Deployment Logs**: æŸ¥çœ‹æ„å»ºå’Œéƒ¨ç½²æ—¥å¿—
- **Runtime Logs**: å®æ—¶æŸ¥çœ‹ API è¯·æ±‚æ—¥å¿—
- **Analytics**: æŸ¥çœ‹è®¿é—®ç»Ÿè®¡å’Œæ€§èƒ½

### æ¨èç›‘æ§

1. **é”™è¯¯è¿½è¸ª**: è€ƒè™‘é›†æˆ Sentry
2. **æ€§èƒ½ç›‘æ§**: ä½¿ç”¨ Vercel Analytics
3. **æ•°æ®åº“ç›‘æ§**: Supabase Dashboard

---

## 11. å›æ»šæ–¹æ¡ˆ

### Vercel å¿«é€Ÿå›æ»š

1. è¿›å…¥ Vercel Dashboard
2. é€‰æ‹© Deployments
3. æ‰¾åˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬
4. ç‚¹å‡» "Promote to Production"

**å›æ»šæ—¶é—´**: < 1 åˆ†é’Ÿ

---

## 12. åˆ›å»ºçš„æ–‡æ¡£

1. **DEPLOYMENT_GUIDE.md** - å®Œæ•´éƒ¨ç½²æŒ‡å—
2. **DEPLOYMENT_CHECKLIST.md** - éƒ¨ç½²æ£€æŸ¥æ¸…å•
3. **DEPLOYMENT_REPORT.md** (æœ¬æ–‡ä»¶) - éƒ¨ç½²å‡†å¤‡æŠ¥å‘Š
4. **.env.production.template** - ç”Ÿäº§ç¯å¢ƒå˜é‡æ¨¡æ¿
5. **vercel.json** - Vercel é…ç½®æ–‡ä»¶

---

## æ€»ç»“

### âœ… å‡†å¤‡å°±ç»ª

Credit Trader é¡¹ç›®å·²å®Œæˆæ‰€æœ‰å¼€å‘å·¥ä½œï¼Œä»£ç è´¨é‡è‰¯å¥½ï¼Œæ„å»ºéªŒè¯é€šè¿‡ï¼Œå¯ä»¥å¼€å§‹ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚

### å…³é”®æŒ‡æ ‡

- **ä»£ç è´¨é‡**: âœ… ä¼˜ç§€ (æ—  TypeScript é”™è¯¯)
- **æ„å»ºé€Ÿåº¦**: âœ… 1.66 ç§’ (éå¸¸å¿«)
- **åŠŸèƒ½å®Œæ•´æ€§**: âœ… 100% (æ‰€æœ‰ PRD åŠŸèƒ½å·²å®ç°)
- **æµ‹è¯•è¦†ç›–**: âœ… ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡
- **æ–‡æ¡£å®Œæ•´æ€§**: âœ… éƒ¨ç½²æ–‡æ¡£é½å…¨

### é¢„è®¡éƒ¨ç½²æ—¶é—´

- **é…ç½®å‡†å¤‡**: 5 åˆ†é’Ÿ
- **é¦–æ¬¡éƒ¨ç½²**: 2-3 åˆ†é’Ÿ
- **OAuth é…ç½®**: 3 åˆ†é’Ÿ
- **éªŒè¯æµ‹è¯•**: 5 åˆ†é’Ÿ

**æ€»è®¡**: 15-20 åˆ†é’Ÿ

### é£é™©è¯„ä¼°

- **æŠ€æœ¯é£é™©**: ğŸŸ¢ ä½ (æ„å»ºéªŒè¯é€šè¿‡)
- **é…ç½®é£é™©**: ğŸŸ¡ ä¸­ (éœ€è¦æ‰‹åŠ¨æ›´æ–° OAuth URL)
- **æ•°æ®é£é™©**: ğŸŸ¢ ä½ (Schema å·²ç¨³å®š)

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. å®¡æŸ¥æœ¬æŠ¥å‘Š
2. ç¡®è®¤ç¯å¢ƒå˜é‡å‡†å¤‡å°±ç»ª
3. é€‰æ‹©éƒ¨ç½²æ–¹å¼ (GitHub æˆ– CLI)
4. æ‰§è¡Œéƒ¨ç½²
5. è¿è¡ŒéªŒè¯æµ‹è¯•
6. ç›‘æ§ç”Ÿäº§ç¯å¢ƒ

---

**æŠ¥å‘ŠçŠ¶æ€**: âœ… å®Œæˆ
**å»ºè®®è¡ŒåŠ¨**: å¯ä»¥å¼€å§‹éƒ¨ç½²

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒ `docs/DEPLOYMENT_GUIDE.md` æˆ–æŸ¥çœ‹ Vercel éƒ¨ç½²æ—¥å¿—ã€‚
